<!-- All material contained herein is copyright (c) McGraw-Hill Professional Books
All Rights Reserved. No use of this material may be made without express written
permission of the copyright holder. HTML conversions by Mega Space [barry@megaspace.com] -->

<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<TITLE>Understanding Digital Signatures: Inside the Java Virtual Machine
 by Bill Venners - Beta Version</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<TABLE BORDER="0" WIDTH="100%">
<TR><TD><A HREF="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" target="bottom"><IMG SRC="hotkey.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/hotkey.gif" ALIGN="LEFT" BORDER="0" WIDTH="40" HEIGHT="40" ALT="Orders"></A>
<IMG SRC="order_text.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/order_text.gif" WIDTH="103" HEIGHT="41" ALT="Orders"></TD>
<TD ALIGN="RIGHT"><A HREF="chap12.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/venners/chap12.html"><IMG SRC="backward.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/backward.gif" BORDER="0" ALT="Backward" WIDTH="32" HEIGHT="32"></A>&nbsp;<A HREF="chap14.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/venners/chap14.html"><IMG SRC="forward.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/forward.gif" BORDER="0" ALT="Forward" WIDTH="32" HEIGHT="32"></A></TD></TR>
<TR><TD COLSPAN="2"><A HREF="mailto:computing@mcgraw-hill.com"><IMG SRC="hotkey.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/hotkey.gif" ALIGN="LEFT" BORDER="0" WIDTH="40" HEIGHT="40" ALT="Comments"></A>
<IMG SRC="comment_text.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/comment_text.gif" WIDTH="73" HEIGHT="39" ALT="Comments"></TD></TR>

<TR><TD COLSPAN="2"><FONT FACE="ARIEL,HELVETICA" SIZE="-1"><I>&copy; 1997 The McGraw-Hill Companies, Inc.  All rights reserved.  <BR>Any use of this Beta Book is subject to the rules stated in the <A HREF="http://www.mcgraw-hill.com/corporate/news_info/copyrttm.htm" tppabs="http://www.mcgraw-hill.com/corporate/news_info/copyrttm.htm" target="_top">Terms of Use</A>.</I></FONT><br>
<script language="javascript">
    document.write("<a href='http://banners.linkbuddies.com/click.php?id=237296'><img src='http://banners.linkbuddies.com/image.php?id=237296&ref=" + document.referrer + "' width=468 height=60 alt='Click Here' border=0></a>");
</script></TD></TR>

</TABLE>
<HR>
<P><H1>Chapter Thirteen</H1></P>
<P><H2>Logic</H2></P>
<P>This chapter describes the instructions that perform bitwise logical operations inside the Java Virtual Machine. These instructions include opcodes to perform shifting and boolean operations on integers. The boolean operations are performed on individual bits of integer values. </P>
<P>Accompanying this chapter on the CD-ROM is an applet that interactively illustrates the material presented in the chapter. The applet, named <I>Logical Results</I>, simulates the Java Virtual Machine executing a method that includes uses several of the logic opcodes. At the end of this chapter, you will find a description of this applet and the bytecodes it executes.</P>
<H3><EM><P>The Logic Opcodes</P>
</EM></H3><P>The Java Virtual Machine's logic capabilities operate on <FONT FACE="Courier New">int</FONT>s and <FONT FACE="Courier New">long</FONT>s. These operations treat <FONT FACE="Courier New">int</FONT>s and <FONT FACE="Courier New">long</FONT>s not so much as signed two's-complement numbers, necessarily, but as generic bit patterns. Integer shifting is accomplished via the <FONT FACE="Courier New">ishl</FONT>, <FONT FACE="Courier New">ishr</FONT>, and <FONT FACE="Courier New">iushr</FONT> opcodes. Java's <FONT FACE="Courier New"><FONT FACE="Courier New"></FONT> operator is implemented by <FONT FACE="Courier New">ishl</FONT>. The <FONT FACE="Courier New"></FONT></FONT> operator is implemented by <FONT FACE="Courier New">ishr</FONT>, and the <FONT FACE="Courier New"></FONT></FONT> operator is implemented by <FONT FACE="Courier New">iushl</FONT>. The difference between <FONT FACE="Courier New">ishr</FONT> and <FONT FACE="Courier New">iushr</FONT> is that only <FONT FACE="Courier New">ishr</FONT> does sign extension. Table 13-1 shows the instructions that shift <FONT FACE="Courier New">int</FONT>s left and right.</P>
<P>Table 13-1. Shifting <FONT FACE="Courier New">int</FONT>s</P>
<TABLE WIDTH="500">
<TR><TD VALIGN="TOP"><STRONG>Opcode</STRONG></TD><TD VALIGN="TOP"><STRONG>Operand(s)</STRONG></TD><TD VALIGN="TOP"><STRONG>Description</STRONG></TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">ishl</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">shifts <FONT FACE="Courier New">int</FONT> left</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">ishr</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">arithmetic shifts <FONT FACE="Courier New">int</FONT> right</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">iushr</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">logical shifts <FONT FACE="Courier New">int</FONT> right</TD></TR>
</TABLE>
<P>Table 13-2 shows the instructions that shift <FONT FACE="Courier New">long</FONT>s left and right.</P>
<P>Table 13-2. Shifting <FONT FACE="Courier New">long</FONT>s</P>
<TABLE WIDTH="500">
<TR><TD VALIGN="TOP"><STRONG>Opcode</STRONG></TD><TD VALIGN="TOP"><STRONG>Operand(s)</STRONG></TD><TD VALIGN="TOP"><STRONG>Description</STRONG></TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">lshl</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">shifts <FONT FACE="Courier New">long</FONT> left</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">lshr</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">arithmetic shifts <FONT FACE="Courier New">long</FONT> right</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">lushr</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">logical shifts <FONT FACE="Courier New">long</FONT> right</TD></TR>
</TABLE>
<P>The opcodes shown in Table 13-3 perform bitwise logical operations on <FONT FACE="Courier New">int</FONT>s. The opcodes implement Java's <FONT FACE="Courier New">&amp;</FONT>, <FONT FACE="Courier New">|</FONT>, and <FONT FACE="Courier New">^</FONT> operators.</P>
<P>Table 13-3. Bitwise logical operations on <FONT FACE="Courier New">int</FONT>s</P>
<TABLE WIDTH="500">
<TR><TD VALIGN="TOP"><STRONG>Opcode</STRONG></TD><TD VALIGN="TOP"><STRONG>Operand(s)</STRONG></TD><TD VALIGN="TOP"><STRONG>Description</STRONG></TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">iand</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean ands two <FONT FACE="Courier New">int</FONT>s</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">ior</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean ors two <FONT FACE="Courier New">int</FONT>s</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">ixor</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean xors two <FONT FACE="Courier New">int</FONT>s</TD></TR>
</TABLE>
<P>Table 13-4 shows the opcodes that perform bitwise logical operations on <FONT FACE="Courier New">long</FONT>s.</P>
<P>Table 13-4. Bitwise logical operations on <FONT FACE="Courier New">long</FONT>s</P>
<TABLE WIDTH="500">
<TR><TD VALIGN="TOP"><STRONG>Opcode</STRONG></TD><TD VALIGN="TOP"><STRONG>Operand(s)</STRONG></TD><TD VALIGN="TOP"><STRONG>Description</STRONG></TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">land</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean ands two <FONT FACE="Courier New">long</FONT>s</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">lor</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean ors two <FONT FACE="Courier New">long</FONT>s</TD></TR>
<TR><TD VALIGN="TOP"><FONT FACE="Courier New">lxor</FONT></TD><TD VALIGN="TOP">(none)</TD><TD VALIGN="TOP">boolean xors two <FONT FACE="Courier New">long</FONT>s</TD></TR>
</TABLE>
<P>As mentioned in previous chapters, there is no native <FONT FACE="Courier New">boolean</FONT> type in the Java Virtual Machine. The Java Virtual Machine uses <FONT FACE="Courier New">int</FONT>s to represent <FONT FACE="Courier New">boolean</FONT>s. The instruction set includes many instructions that decide whether or not to jump based on an <FONT FACE="Courier New">int</FONT> value interpreted as a <FONT FACE="Courier New">boolean</FONT>. This instructions are covered in Chapter 16, &quot;Control Flow.&quot;</P>
<I><STRONG><P>Logical Results: A Simulation</P>
</I><P></STRONG>The <I>Logical Results</I> applet, shown in Figure 13-1, demonstrates a Java Virtual Machine executing a sequence of bytecodes. This applet is in a web page on the CD-ROM in file <FONT FACE="Courier New">applets/LogicalResults.html</FONT>. The bytecode sequence in the simulation was generated by <TT>javac</TT> for the <FONT FACE="Courier New">incrementLogically()</FONT> method of the <FONT FACE="Courier New">VulcanCounter</FONT> class:</P>
<PRE><P><FONT FACE="Courier New">begin</FONT></P>
<FONT SIZE="2"><P></FONT><FONT FACE="Courier New">// On CD-ROM in file opcodes/ex1/VulcanCounter.java
<P>class VulcanCounter {</P>
<P>&nbsp;</P>
<P>    static void incrementLogically() {</P>
<P>        int spock = 0;</P>
<P>        for (;;) {</P>
<P>            int tempSpock = spock;</P>
<P>            for (int i = 0; i &lt; 32; ++i) {</P>
<P>                int mask = 0x1 <FONT FACE="Courier New"> i;</P>
<P>                if ((tempSpock &amp; mask) == 0) {</P>
<P>                    tempSpock |= mask;  // Change 0 to 1</P>
<P>                    break;</P>
<P>                }</P>
<P>                else {</P>
<P>                    tempSpock &amp;= ~mask; // Change 1 to 0</P>
<P>                }</P>
<P>            }</P>
<P>            spock = tempSpock;</P>
<P>        }</P>
<P>    }</P>
<P>}</P>
</FONT><FONT SIZE="2"><P>&nbsp;</P></FONT><FONT FACE="Courier New">end</FONT></P></PRE>
<P>The bytecodes generated by <TT>javac</TT> for <FONT FACE="Courier New">incrementLogically()</FONT> are:</P>
<PRE><P><FONT FACE="Courier New">begin</FONT></P>
<FONT SIZE="2"><P></FONT><FONT FACE="Courier New"> 0 iconst_0     // Push int constant 0.
<P> 1 istore_0     // Pop to local variable 0: int spock = 0;</P>
<P> 2 iload_0      // Push local variable 0 (spock).</P>
<P> 3 istore_1     // Pop to local variable 1: int tempSpock = spock;</P>
<P> 4 iconst_0     // Push int constant 0.</P>
<P> 5 istore_2     // Pop to local variable 2: int i = 0;</P>
<P> 6 goto 35      // Jump unconditionally ()</P>
<P> 9 iconst_1     // Push int constant 1.</P>
<P>10 iload_2      // Push local variable 2 (i).</P>
<P>11 ishl         // Arithmetic shift left top int (i) by next</P>
<P>                // to top int (1).</P>
<P>12 istore_3     // Pop to local variable 3: int mask = i <FONT FACE="Courier New"> 0x1;</P>
<P>13 iload_1      // Push local variable 1 (tempSpock).</P>
<P>14 iload_3      // Push local variable 3 (mask).</P>
<P>15 iand         // Bitwise AND top two ints: (spock &amp; mask)</P>
<P>16 ifne 26      // Jump if top of stack is not equal to zero:</P>
<P>                // if ((spock &amp; mask) == 0) {</P>
<P>19 iload_1      // Push local variable 1 (tempSpock).</P>
<P>20 iload_3      // Push local variable 3 (mask).</P>
<P>21 ior          // Bitwise OR top two ints (tempSpock | mask)</P>
<P>22 istore_1     // Pop to local variable 1: tempSpock |= mask;</P>
<P>23 goto 41      // Jump unconditionally (to just after</P>
<P>                // inner for): break;</P>
<P>26 iload_1      // Push local variable 1 (tempSpock).</P>
<P>27 iload_3      // Push local variable 3 (mask).</P>
<P>28 iconst_m1    // Push -1.</P>
<P>29 ixor         // Bitwise EXCLUSIVE-OR top two ints: ~mask</P>
<P>30 iand         // Bitwise AND top two ints: tempSpock &amp; (~mask)</P>
<P>31 istore_1     // Pop to local variable 1: tempSpock &amp;= ~mask;</P>
<P>32 iinc 2 1     // Increment local variable 2 by 1: ++i</P>
<P>35 iload_2      // Push local variable 2 (i).</P>
<P>36 bipush 32    // Push integer constant 32.</P>
<P>38 if_icmplt 9  // Jump (to top of inner for) if "next to top"</P>
<P>                // integer is less than "top" integer: i &lt; 32</P>
<P>41 iload_1      // Push local variable 1 (tempSpock)</P>
<P>42 istore_0     // Pop to local variable 0: spock = tempSpock;</P>
<P>43 goto 2       // Jump unconditionally (to top of outer for).</P>
</FONT><FONT SIZE="2"><P>&nbsp;</P></FONT><FONT FACE="Courier New">end</PRE></FONT></P></PRE>
<P>The <FONT FACE="Courier New">incrementLogically()</FONT> method repeatedly increments an <FONT FACE="Courier New">int</FONT> without using the <FONT FACE="Courier New">+</FONT> or <FONT FACE="Courier New">++</FONT> operators. It uses only the logical operators: <FONT FACE="Courier New">&amp;</FONT>, <FONT FACE="Courier New">|</FONT>, and <FONT FACE="Courier New">~</FONT>. An increment is accomplished by searching through the bits of the current <FONT FACE="Courier New">int</FONT>, starting with the lowest order bit, and turning ones to zeros. As soon as a one is encountered in the current <FONT FACE="Courier New">int</FONT>, it is changed to zero and the search stops. The resultant <FONT FACE="Courier New">int</FONT> now represents the old <FONT FACE="Courier New">int</FONT> incremented by one. The process is started again on the new <FONT FACE="Courier New">int</FONT>. Each incremented number is stored in the <FONT FACE="Courier New">spock</FONT> variable. <FONT FACE="Courier New">spock</FONT> is local variable zero in the compiled bytecodes, so you can watch local variable zero count 0, 1, 2, 3, and so on.</P>
<P>To drive the <I>Logical Results</I> simulation, use the Step, Reset, Run, and Stop buttons. Each time you press the Step button, the simulator will execute the instruction pointed to by the pc register. If you press the Run button, the simulation will continue with no further coaxing on your part until you press the Stop button. To start the simulation over, press the Reset button. For each step of the simulation, a panel at the bottom of the applet contains an explanation of what the next instruction will do. Happy clicking.</P>
<P><IMG SRC="fig13-1.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/venners/images/fig13-1.gif" ALT="Figure 13-1"></P></PRE>

<H3><EM><P>On the CD-ROM</P>
</EM></H3><P>The CD-ROM contains the source code examples from this chapter in the <FONT FACE="Courier New">opcodes</FONT> directory. The <I>Logical Results</I> applet is in a web page on the CD-ROM in file <FONT FACE="Courier New">applets/LogicalResults.html</FONT>. The source code for this applet is found alongside its class files, in the <FONT FACE="Courier New">applets/JVMSimulators</FONT> and <FONT FACE="Courier New">applets/JVMSimulators/COM/artima/jvmsim</FONT> directories.</P>
<H3><EM><P>The Resources Page</P></PRE>
</EM></H3><P>For more information about the material presented in this chapter, visit the resources page: <FONT FACE="Courier New"><A HREF="http://www.artima.com/insidejvm/logic.html" tppabs="http://www.artima.com/insidejvm/logic.html">http://www.artima.com/insidejvm/logic.html</A></FONT>.</P>
<TABLE BORDER="0" WIDTH="100%">
<TR><TD><A HREF="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" target="bottom"><IMG SRC="hotkey.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/hotkey.gif" ALIGN="LEFT" BORDER="0" WIDTH="40" HEIGHT="40" ALT="Orders"></A>
<IMG SRC="order_text.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/order_text.gif" WIDTH="103" HEIGHT="41" ALT="Orders"></TD>
<TD ALIGN="RIGHT"><A HREF="chap12.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/venners/chap12.html"><IMG SRC="backward.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/backward.gif" BORDER="0" ALT="Backward" WIDTH="32" HEIGHT="32"></A>&nbsp;<A HREF="chap14.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/venners/chap14.html"><IMG SRC="forward.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/forward.gif" BORDER="0" ALT="Forward" WIDTH="32" HEIGHT="32"></A></TD></TR>
<TR><TD COLSPAN="2"><A HREF="mailto:computing@mcgraw-hill.com"><IMG SRC="hotkey.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/hotkey.gif" ALIGN="LEFT" BORDER="0" WIDTH="40" HEIGHT="40" ALT="Comments"></A>
<IMG SRC="comment_text.gif" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/images/comment_text.gif" WIDTH="73" HEIGHT="39" ALT="Comments"></TD></TR>

</TABLE>
<HR>
<P ALIGN=CENTER>&nbsp;<A HREF="http://www.pbg.mcgraw-hill.com/computing/computing-home.html" tppabs="http://www.pbg.mcgraw-hill.com/computing/computing-home.html" TARGET="_top">COMPUTING
MCGRAW-HILL</A> | <A HREF="http://www.pbg.mcgraw-hill.com/betabooks/betabooks-home.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/betabooks-home.html" TARGET="_top">Beta Books</A>
| <A HREF="http://www.pbg.mcgraw-hill.com/computing/contact.html" tppabs="http://www.pbg.mcgraw-hill.com/computing/contact.html" TARGET="_top">Contact Us</A>
| <A HREF="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" tppabs="http://www.pbg.mcgraw-hill.com/betabooks/stores.html" TARGET="_top">Order Information</A>
| <A HREF="http://mcgraw-hill.inforonics.com/compsearch.shtml" tppabs="http://mcgraw-hill.inforonics.com/compsearch.shtml" TARGET="_top">Online Catalog</A></P>

<P ALIGN=CENTER><FONT SIZE="-1"><A HREF="http://www.pbg.mcgraw-hill.com/computing/computing-home.html" tppabs="http://www.pbg.mcgraw-hill.com/computing/computing-home.html" TARGET="_top">Computing McGraw-Hill</A> is an imprint of the <A HREF="http://www.pbg.mcgraw-hill.com/pbg-home.html" tppabs="http://www.pbg.mcgraw-hill.com/pbg-home.html" TARGET="_top">McGraw-Hill Professional Book Group</A>.</FONT></P>

<!-- begin footer -->
<HR>
<A HREF="http://www.mcgraw-hill.com/" tppabs="http://www.mcgraw-hill.com/" TARGET="_top"><IMG SRC="division-white.gif" tppabs="http://www.pbg.mcgraw-hill.com/images/division-white.gif" WIDTH="350" HEIGHT="44" ALT="A Division of the McGraw-Hill Companies" BORDER="0"></A><BR>
<FONT SIZE="-2">Copyright &copy; 1997 <A HREF="http://www.mcgraw-hill.com/" tppabs="http://www.mcgraw-hill.com/" TARGET="_top">
The McGraw-Hill Companies</A>. All rights reserved. Any use is subject to the 
<A HREF="http://www.mcgraw-hill.com/corporate/news_info/copyrttm.htm" tppabs="http://www.mcgraw-hill.com/corporate/news_info/copyrttm.htm" TARGET="_top">
Terms of Use</A>; the corporation also has a comprehensive <A HREF="http://www.mcgraw-hill.com/corporate/news_info/privacy.html" tppabs="http://www.mcgraw-hill.com/corporate/news_info/privacy.html" TARGET="_top">
Privacy Policy</A> governing information we may collect from our customers.</FONT>
<!-- end footer -->
</BODY>
</HTML>
